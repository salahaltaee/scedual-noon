<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· - Scudual</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <style>
    body { background:#f8f9fa }
    .link-btn { font-size:1.05rem; padding:12px 16px; }
    .link-card { transition:.15s; }
    .link-card:hover { transform: translateY(-2px); }
    .truncate { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:100%; display:inline-block; vertical-align:bottom; }
  </style>

  <script>
    // ØªÙ‡ÙŠØ¦Ø© Firebase (Ù†ÙØ³ Ù…Ø´Ø±ÙˆØ¹Ùƒ)
    const firebaseConfig = {
      apiKey: "AIzaSyBsBJNcvaJXiIcJShLiwa-WFtY-VUMGTuk",
      authDomain: "scudual.firebaseapp.com",
      projectId: "scudual"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©
    function normalizeUrl(u){
      if(!u) return '';
      // Ù„Ùˆ Ù…Ø§ÙƒÙˆ Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ØŒ Ù†Ø¶ÙŠÙ https://
      if(!/^https?:\/\//i.test(u)) u = 'https://' + u;
      return u.trim();
    }
    function isValidUrl(u){
      try { new URL(u); return true; } catch { return false; }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø®ØµØµØ©
    async function loadCustomLinks(){
      const wrap = document.getElementById('customLinks');
      wrap.innerHTML = `<div class="text-muted">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>`;
      try{
        const snap = await db.collection('links').orderBy('createdAt','desc').get();
        if(snap.empty){
          wrap.innerHTML = `<div class="alert alert-secondary">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø· Ù…Ø¶Ø§ÙØ© Ø¨Ø¹Ø¯.</div>`;
          return;
        }
        let html = '';
        snap.forEach(doc=>{
          const d = doc.data();
          const url = d.url || '';
          const title = d.title || 'Ø±Ø§Ø¨Ø·';
          html += `
            <div class="d-flex align-items-center justify-content-between p-3 mb-2 border rounded bg-white link-card">
              <div class="me-2">
                <div class="fw-bold truncate">${title}</div>
                <div class="text-muted small truncate">${url}</div>
              </div>
              <div class="d-flex gap-2">
                <a class="btn btn-primary btn-sm" href="${url}" target="_blank" rel="noopener">ÙØªØ­</a>
                <button class="btn btn-outline-danger btn-sm" onclick="deleteLink('${doc.id}')">Ø­Ø°Ù</button>
              </div>
            </div>`;
        });
        wrap.innerHTML = html;
      }catch(err){
        console.error('loadCustomLinks error', err);
        wrap.innerHTML = `<div class="alert alert-danger">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·.</div>`;
      }
    }

    // Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯
    async function addLink(){
      const titleEl = document.getElementById('linkTitle');
      const urlEl   = document.getElementById('linkUrl');
      const resEl   = document.getElementById('addResult');

      let title = (titleEl.value || '').trim();
      let url   = normalizeUrl(urlEl.value || '');

      resEl.className = 'mt-2';
      resEl.innerHTML = '';

      if(!title || !url){
        resEl.classList.add('text-danger');
        resEl.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø²Ø± ÙˆØ§Ù„Ø±Ø§Ø¨Ø·.';
        return;
      }
      if(!isValidUrl(url)){
        resEl.classList.add('text-danger');
        resEl.textContent = 'Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ§Ù„Ø­.';
        return;
      }

      try{
        // Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø¹Ù„Ù‰ Ø£Ø³Ø§Ø³ Ù†ÙØ³ Ø§Ù„Ø±Ø§Ø¨Ø·
        const exist = await db.collection('links').where('url','==',url).get();
        if(!exist.empty){
          resEl.classList.add('text-warning');
          resEl.textContent = 'Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹.';
          return;
        }
        await db.collection('links').add({
          title, url,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        resEl.classList.add('text-success');
        resEl.textContent = 'ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­.';
        titleEl.value = ''; urlEl.value = '';
        loadCustomLinks();
      }catch(err){
        console.error('addLink error', err);
        resEl.classList.add('text-danger');
        resEl.textContent = 'ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø·.';
      }
    }

    // Ø­Ø°Ù Ø±Ø§Ø¨Ø·
    async function deleteLink(id){
      if(!confirm('ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø·ØŸ')) return;
      try{
        await db.collection('links').doc(id).delete();
        loadCustomLinks();
      }catch(err){
        console.error('deleteLink error', err);
        alert('ØªØ¹Ø°Ø± Ø­Ø°Ù Ø§Ù„Ø±Ø§Ø¨Ø·.');
      }
    }

    window.onload = () => {
      loadCustomLinks();
    };
  </script>
</head>
<body>
  <div class="container py-4">
    <h3 class="text-center mb-4">ğŸ”— Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</h3>

    <!-- Ø±ÙˆØ§Ø¨Ø· Ø«Ø§Ø¨ØªØ© -->
    <div class="card mb-4">
      <div class="card-header bg-dark text-white">Ø±ÙˆØ§Ø¨Ø· Ø£Ø³Ø§Ø³ÙŠØ©</div>
      <div class="card-body">
        <div class="row g-2">
          <div class="col-md-6 col-lg-3">
            <a href="https://salahaltaee.github.io/scedual-noon/index.html" target="_blank" class="btn btn-primary w-100 link-btn">Ø­Ø¬Ø² Ø§Ù„Ù…ÙˆØ¹Ø¯</a>
          </div>
          <div class="col-md-6 col-lg-3">
            <a href="https://salahaltaee.github.io/scedual-noon/admin.html" target="_blank" class="btn btn-secondary w-100 link-btn">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
          </div>
          <div class="col-md-6 col-lg-3">
            <a href="https://salahaltaee.github.io/noonscudul/" target="_blank" class="btn btn-success w-100 link-btn">ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±</a>
          </div>
          <div class="col-md-6 col-lg-3">
            <a href="https://salahaltaee.github.io/noonscudul/editor.html" target="_blank" class="btn btn-info w-100 link-btn">Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙˆÙ†ØªÙŠØ±</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Ø±ÙˆØ§Ø¨Ø· Ù…Ø®ØµØµØ© Ù…Ù† Firestore -->
    <div class="card mb-4">
      <div class="card-header bg-primary text-white">Ø£Ø²Ø±Ø§Ø±ÙŠ Ø§Ù„Ù…Ø®ØµØµØ©</div>
      <div class="card-body" id="customLinks">
        <div class="text-muted">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
      </div>
    </div>

    <!-- Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø¬Ø¯ÙŠØ¯ -->
    <div class="card">
      <div class="card-header bg-warning-subtle">â• Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯</div>
      <div class="card-body">
        <div class="row g-3 align-items-end">
          <div class="col-md-5">
            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø²Ø±</label>
            <input id="linkTitle" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ÙˆØ§ØªØ¨">
          </div>
          <div class="col-md-5">
            <label class="form-label">Ø§Ù„Ø±Ø§Ø¨Ø·</label>
            <input id="linkUrl" class="form-control" placeholder="Ù…Ø«Ø§Ù„: https://example.com">
          </div>
          <div class="col-md-2">
            <button class="btn btn-success w-100" onclick="addLink()">Ø¥Ø¶Ø§ÙØ©</button>
          </div>
        </div>
        <div id="addResult" class="mt-2 small"></div>
      </div>
    </div>

    <div class="text-center text-muted mt-4 small">Â© Ø§Ø³ØªÙˆØ¯ÙŠÙˆ Ù†ÙˆÙ†</div>
  </div>
</body>
</html>

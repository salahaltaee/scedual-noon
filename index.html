<!-- index.html: Booking Page without Login -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>حجز موعد | Studio Noon</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBsBJNcvaJXiIcJShLiwa-WFtY-VUMGTuk",
      authDomain: "scudual.firebaseapp.com",
      projectId: "scudual",
      storageBucket: "scudual.appspot.com",
      messagingSenderId: "293995901551",
      appId: "1:293995901551:web:YOUR_APP_ID",
      measurementId: "G-XXXXXXXXXX"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="text-center mb-4">احجز موعدك مع Studio Noon</h2>
    <form id="bookingForm" class="row g-3">
      <div class="col-md-4">
        <label for="teacherSelect" class="form-label">اختر الأستاذ</label>
        <select id="teacherSelect" class="form-select" required></select>
      </div>
      <div class="col-md-4">
        <label for="dateInput" class="form-label">📅 تاريخ الموعد (الغد)</label>
        <input type="date" id="dateInput" class="form-control" readonly>
      </div>
      <div class="col-md-4">
        <label for="timeSelect" class="form-label">⏰ اختر الوقت</label>
        <select id="timeSelect" class="form-select" required>
          <!-- خيارات من 00:00 إلى 24:00 -->
        </select>
      </div>
      <div class="col-12 text-center">
        <button type="submit" class="btn btn-success me-2">تثبيت الطلب</button>
        <button type="button" id="whatsappBtn" class="btn btn-outline-primary">إرسال رسالة</button>
      </div>
    </form>
  </div>
  <script>
    // Populate date for tomorrow
    const dateInput = document.getElementById('dateInput');
    const tomorrow = new Date(); tomorrow.setDate(tomorrow.getDate() + 1);
    const iso = tomorrow.toISOString().split('T')[0];
    dateInput.value = iso;

    // Populate time options
    const timeSelect = document.getElementById('timeSelect');
    for(let h=0; h<24; h++){
      ['00','30'].forEach(m=>{
        const val = `${String(h).padStart(2,'0')}:${m}`;
        const opt = document.createElement('option'); opt.value=val; opt.textContent=val;
        timeSelect.append(opt);
      });
    }

    // Load teachers
    const teacherSelect = document.getElementById('teacherSelect');
    db.collection('users').where('role','==','teacher').get().then(snap=>{
      snap.forEach(doc=>{
        const opt = document.createElement('option');
        opt.value = doc.id;
        opt.textContent = doc.data().name;
        teacherSelect.append(opt);
      });
    });

    // Prevent duplicate
    document.getElementById('bookingForm').addEventListener('submit', async e=>{
      e.preventDefault();
      const teacherId = teacherSelect.value;
      const teacherName = teacherSelect.options[teacherSelect.selectedIndex].text;
      const date = dateInput.value;
      const time = timeSelect.value;

      const exists = await db.collection('bookings')
        .where('userId','==',teacherId)
        .where('date','==',date)
        .where('time','==',time)
        .get();
      if(!exists.empty) return alert('⚠️ تم حجز هذا الموعد مسبقًا');

      await db.collection('bookings').add({ userId:teacherId, userName:teacherName, date, time, studio:'الرئيسي', status:'pending' });
      alert('✅ تم تثبيت الطلب');
    });

    // Whatsapp message
    document.getElementById('whatsappBtn').addEventListener('click', ()=>{
      const teacherName = teacherSelect.options[teacherSelect.selectedIndex].text;
      const msg = encodeURIComponent(`مرحبا استوديو نون انا الاستاذ ${teacherName} اريد حجزيوم غد الساعة ${timeSelect.value}`);
      window.open(`https://wa.me/9647855002173?text=${msg}`, '_blank');
    });
  </script>

<!-- admin.html: Admin Dashboard -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>لوحة الإدارة</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig={apiKey:"AIzaSyBsBJNcvaJXiIcJShLiwa-WFtY-VUMGTuk",authDomain:"scudual.firebaseapp.com",projectId:"scudual"};
    firebase.initializeApp(firebaseConfig);const auth=firebase.auth(),db=firebase.firestore();
  </script>
</head>
<body class="bg-light p-4">
  <div class="container">
    <h3 class="mb-4 text-center">📋 لوحة تحكم المدير</h3>

    <h5 class="mb-3">🕒 طلبات الحجوزات</h5>
    <div id="pendingBookings"></div>

    <hr class="my-4">

    <h5 class="mb-3">📊 تقرير الحجوزات</h5>
    <div id="reportTable"></div>

    <hr class="my-4">

    <h5 class="mb-3">➕ إضافة أستاذ</h5>
    <form id="addTeacherForm" class="row g-3 mb-4">
      <div class="col-md-6"><input id="tName" class="form-control" placeholder="اسم الأستاذ"></div>
      <div class="col-md-6"><button class="btn btn-success w-100" type="submit">إضافة</button></div>
    </form>
  </div>
  <script>
    auth.onAuthStateChanged(u=>{if(!u)return; renderPending(); renderReport();});
    function renderPending(){db.collection('bookings').where('status','==','pending').get().then(s=>{let h='';s.forEach(d=>{const data=d.data();h+=`<div class="card mb-2"><div class="card-body d-flex justify-content-between"><div>${data.userName} - ${data.date} ${data.time}</div><div><button class="btn btn-sm btn-success" onclick="update('${d.id}','active')">✔</button><button class="btn btn-sm btn-danger ms-2" onclick="update('${d.id}','rejected')">✖</button></div></div></div>`});document.getElementById('pendingBookings').innerHTML=h||'<div class="alert alert-secondary">لا طلبات</div>';});}
    function update(id,s){db.collection('bookings').doc(id).update({status:s}).then(renderPending,renderReport);}
    function renderReport(){db.collection('bookings').where('status','==','active').get().then(s=>{const cnt={};s.forEach(d=>{const u=d.data().userName;cnt[u]=(cnt[u]||0)+1});let t='<table class="table"><thead><tr><th>الأستاذ</th><th>عدد الحجوزات</th></tr></thead><tbody>';for(const k in cnt)t+=`<tr><td>${k}</td><td>${cnt[k]}</td></tr>`;t+='</tbody></table>';document.getElementById('reportTable').innerHTML=t;});}
    document.getElementById('addTeacherForm').addEventListener('submit',e=>{e.preventDefault();const n=document.getElementById('tName').value;db.collection('users').add({name:n,role:'teacher'}).then(()=>alert('تمت الإضافة'),console.error);});
  </script>
</body>
</html>

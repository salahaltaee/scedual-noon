<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† - Scudual</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body class="bg-light">

<div class="container my-5">
  <h3 class="text-center mb-4">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>

  <!-- âœ… Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</div>
    <div class="card-body">
      <form id="addUserForm" class="row g-3">
        <div class="col-md-3">
          <input type="text" id="name" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required>
        </div>
        <div class="col-md-3">
          <input type="email" id="email" class="form-control" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
        </div>
        <div class="col-md-3">
          <input type="password" id="password" class="form-control" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
        </div>
        <div class="col-md-2">
          <select id="role" class="form-select" required>
            <option value="teacher">Ø£Ø³ØªØ§Ø°</option>
            <option value="admin">Ù…Ø¯ÙŠØ±</option>
          </select>
        </div>
        <div class="col-md-1">
          <button type="submit" class="btn btn-success w-100">Ø¥Ø¶Ø§ÙØ©</button>
        </div>
      </form>
      <div id="addUserMsg" class="mt-3 text-success text-center"></div>
    </div>
  </div>

  <!-- âœ… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
  <div class="card">
    <div class="card-header bg-secondary text-white">ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
    <div class="card-body" id="usersList">
      <p class="text-muted">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
    </div>
  </div>
</div>
<script>
  // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBsBJNcvaJXiIcJShLiwa-WFtY-VUMGTuk",
    authDomain: "scudual.firebaseapp.com",
    projectId: "scudual"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // âœ… Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
  document.getElementById("addUserForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const name = document.getElementById("name").value;
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    const role = document.getElementById("role").value;
    const msg = document.getElementById("addUserMsg");

    try {
      const newUser = await auth.createUserWithEmailAndPassword(email, password);
      const uid = newUser.user.uid;

      await db.collection("users").doc(uid).set({
        name,
        role
      });

      msg.textContent = "âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­.";
      document.getElementById("addUserForm").reset();
      loadUsers();
    } catch (error) {
      msg.textContent = "âŒ Ø®Ø·Ø£: " + error.message;
    }
  });

  // âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Firestore
  async function loadUsers() {
    const container = document.getElementById("usersList");
    container.innerHTML = "";

    const snapshot = await db.collection("users").get();

    if (snapshot.empty) {
      container.innerHTML = "<p class='text-muted'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø¹Ø¯.</p>";
      return;
    }

    snapshot.forEach(doc => {
      const user = doc.data();
      const card = document.createElement("div");
      card.className = "border p-3 rounded mb-2 d-flex justify-content-between align-items-center bg-white";

      card.innerHTML = `
        <div>
          <strong>${user.name}</strong> - ${user.role}
        </div>
        <button class="btn btn-sm btn-danger" onclick="deleteUser('${doc.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
      `;
      container.appendChild(card);
    });
  }

  // âœ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ÙÙ‚Ø· Ù…Ù† Firestore)
  async function deleteUser(uid) {
    if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ")) {
      await db.collection("users").doc(uid).delete();
      loadUsers();
    }
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
  window.onload = loadUsers;
</script>
</body>
</html>

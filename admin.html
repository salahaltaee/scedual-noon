<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>لوحة التحكم - منصة نون</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: "Tahoma", sans-serif; background: #f8f9fa; margin: 20px; }
    h1, h2 { text-align: center; color: #333; }
    .section { background: #fff; padding: 20px; margin: 15px auto; border-radius: 8px; box-shadow: 0 0 5px #ddd; width: 90%; max-width: 900px; }
    label { display: block; margin-top: 10px; }
    input, select, button { padding: 8px; margin-top: 5px; width: 100%; border-radius: 4px; border: 1px solid #ccc; }
    button { background: #007bff; color: #fff; cursor: pointer; border: none; }
    button:hover { background: #0056b3; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 8px; text-align: center; }
  </style>
</head>
<body>

  <h1>لوحة التحكم - منصة نون</h1>

  <!-- إضافة أستاذ -->
  <div class="section">
    <h2>إضافة أستاذ</h2>
    <label>اسم الأستاذ:</label>
    <input type="text" id="teacherName">
    <label>الإيميل:</label>
    <input type="email" id="teacherEmail">
    <label>كلمة المرور:</label>
    <input type="password" id="teacherPassword">
    <button onclick="addTeacher()">إضافة</button>
  </div>

  <!-- إضافة حجز يدوي -->
  <div class="section">
    <h2>إضافة حجز يدوي</h2>
    <label>الأستاذ:</label>
    <select id="teacherSelect"></select>
    <label>اسم الطالب:</label>
    <input type="text" id="studentName">
    <label>تاريخ الحجز:</label>
    <input type="date" id="bookingDate">
    <button onclick="createManualBooking()">إضافة الحجز</button>
  </div>

  <!-- حجوزات اليوم -->
  <div class="section">
    <h2>حجوزات اليوم</h2>
    <button onclick="printToday()">🖨️ طباعة حجوزات اليوم</button>
    <table id="todayBookings">
      <thead>
        <tr><th>الأستاذ</th><th>الطالب</th><th>التاريخ</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- حجوزات الغد -->
  <div class="section">
    <h2>حجوزات الغد</h2>
    <button onclick="printTomorrow()">🖨️ طباعة حجوزات الغد</button>
    <table id="tomorrowBookings">
      <thead>
        <tr><th>الأستاذ</th><th>الطالب</th><th>التاريخ</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- حجوزات الشهر -->
  <div class="section">
    <h2>حجوزات الشهر</h2>
    <table id="monthlyBookings">
      <thead>
        <tr><th>الأستاذ</th><th>الطالب</th><th>التاريخ</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // 🔥 تهيئة Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyASqGIwNVzkLt2t6pIRRrd7WC2ltN4A34E",
      authDomain: "noon-4dec9.firebaseapp.com",
      projectId: "noon-4dec9",
      storageBucket: "noon-4dec9.appspot.com",
      messagingSenderId: "419619843903",
      appId: "1:419619843903:web:abc123"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // 🧑‍🏫 إضافة أستاذ
    async function addTeacher() {
      const name = document.getElementById("teacherName").value;
      const email = document.getElementById("teacherEmail").value;
      const password = document.getElementById("teacherPassword").value;
      if (!name || !email || !password) { alert("أكمل جميع الحقول"); return; }

      try {
        await db.collection("teachers").add({ name, email, password });
        alert("تمت إضافة الأستاذ بنجاح ✅");
        loadTeachers();
      } catch (err) {
        console.error("خطأ إضافة أستاذ:", err);
      }
    }

    // 📋 تحميل قائمة الأساتذة
    async function loadTeachers() {
      const select = document.getElementById("teacherSelect");
      select.innerHTML = "";
      try {
        const snapshot = await db.collection("teachers").get();
        snapshot.forEach(doc => {
          const option = document.createElement("option");
          option.value = doc.id;
          option.textContent = doc.data().name;
          select.appendChild(option);
        });
      } catch (err) {
        console.error("خطأ تحميل الأساتذة:", err);
      }
    }

    // ✍️ إضافة حجز يدوي
    async function createManualBooking() {
      const teacherId = document.getElementById("teacherSelect").value;
      const studentName = document.getElementById("studentName").value;
      const bookingDate = document.getElementById("bookingDate").value;

      if (!teacherId || !studentName || !bookingDate) { alert("أكمل جميع الحقول"); return; }

      try {
        await db.collection("bookings").add({
          teacherId, studentName,
          date: bookingDate
        });
        alert("تمت إضافة الحجز ✅");
        loadBookings();
      } catch (err) {
        console.error("خطأ إنشاء الحجز اليدوي:", err);
      }
    }

    // 📅 تحميل الحجوزات
    async function loadBookings() {
      const today = new Date().toISOString().split("T")[0];
      const tomorrow = new Date(Date.now() + 86400000).toISOString().split("T")[0];
      const month = today.substring(0,7);

      const todayTable = document.querySelector("#todayBookings tbody");
      const tomorrowTable = document.querySelector("#tomorrowBookings tbody");
      const monthlyTable = document.querySelector("#monthlyBookings tbody");
      todayTable.innerHTML = ""; tomorrowTable.innerHTML = ""; monthlyTable.innerHTML = "";

      try {
        const snapshot = await db.collection("bookings").get();
        snapshot.forEach(doc => {
          const data = doc.data();
          const row = `<tr><td>${data.teacherId}</td><td>${data.studentName}</td><td>${data.date}</td></tr>`;
          if (data.date === today) todayTable.innerHTML += row;
          if (data.date === tomorrow) tomorrowTable.innerHTML += row;
          if (data.date.startsWith(month)) monthlyTable.innerHTML += row;
        });
      } catch (err) {
        console.error("خطأ تحميل الحجوزات:", err);
      }
    }

    // 🖨️ الطباعة
    function printToday() { window.print(); }
    function printTomorrow() { window.print(); }

    // تحميل تلقائي عند الفتح
    loadTeachers();
    loadBookings();
  </script>
</body>
</html>
